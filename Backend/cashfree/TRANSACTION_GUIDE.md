# Cashfree Transaction Fetching - Usage Guide\n\nThis guide explains how to fetch and display Cashfree transactions in your gym management system.\n\n## 🚀 Quick Start\n\n### 1. Environment Setup\nMake sure your `.env` file contains:\n```\nCASHFREE_APP_ID=your_app_id_here\nCASHFREE_SECRET_KEY=your_secret_key_here\n```\n\n### 2. Available Methods\n\n#### Command Line Scripts\n```bash\n# Test the transaction fetching system\nnpm run test-transactions\n\n# Fetch specific transactions by order ID\nnpm run fetch-transactions ORDER123 ORDER456 ORDER789\n\n# Or run directly with node\nnode scripts/fetchTransactions.js ORDER123 ORDER456\n```\n\n#### API Endpoints\nOnce your server is running, you can use these endpoints:\n\n**1. Get All Transactions (POST /api/cashfree/transactions)**\n```json\n{\n  \"orderIds\": [\"ORDER123\", \"ORDER456\", \"ORDER789\"]\n}\n```\n\n**2. Get Single Order Details (GET /api/cashfree/order/:orderId)**\n```\nGET /api/cashfree/order/ORDER123\n```\n\n**3. Print All Transactions to Console (POST /api/cashfree/print-transactions)**\n```json\n{\n  \"orderIds\": [\"ORDER123\", \"ORDER456\"]\n}\n```\n\n## 📊 What You'll Get\n\n### Console Output\nWhen you fetch transactions, you'll see detailed information printed to the console:\n\n```\n=== CASHFREE TRANSACTIONS ===\n\n--- Transaction 1 ---\nOrder ID: ORDER123\nAmount: ₹1500 INR\nStatus: PAID\nCustomer: John Doe\nEmail: john@example.com\nPhone: +919876543210\nCreated: 12/25/2024, 10:30:00 AM\nPayment Details:\n  Payment 1:\n    Payment ID: CF_123456\n    Payment Status: SUCCESS\n    Payment Method: UPI\n    Payment Amount: ₹1500\n    Payment Time: 12/25/2024, 10:31:15 AM\n\n=== Total Transactions: 1 ===\n```\n\n### API Response\n```json\n{\n  \"success\": true,\n  \"transactions\": [\n    {\n      \"orderId\": \"ORDER123\",\n      \"orderAmount\": \"1500\",\n      \"orderStatus\": \"PAID\",\n      \"orderCurrency\": \"INR\",\n      \"customerDetails\": {\n        \"customer_name\": \"John Doe\",\n        \"customer_email\": \"john@example.com\",\n        \"customer_phone\": \"+919876543210\"\n      },\n      \"createdAt\": \"2024-12-25T05:00:00.000Z\",\n      \"paymentDetails\": [\n        {\n          \"cf_payment_id\": \"CF_123456\",\n          \"payment_status\": \"SUCCESS\",\n          \"payment_group\": \"upi\",\n          \"payment_amount\": \"1500\",\n          \"payment_time\": \"2024-12-25T05:01:15.000Z\"\n        }\n      ]\n    }\n  ],\n  \"summary\": {\n    \"total\": 1,\n    \"successful\": 1,\n    \"failed\": 0,\n    \"pending\": 0,\n    \"totalAmount\": 1500\n  }\n}\n```\n\n## 🔧 Integration with Your Database\n\nTo integrate with your existing gym management system:\n\n1. **Get Order IDs from Database**: Modify the `printAllTransactions` function to fetch order IDs from your MongoDB:\n\n```javascript\n// Example: In your controller\nimport { Order } from '../models/Order.js'; // Adjust path as needed\n\nexport const fetchAllGymTransactions = async (req, res) => {\n  try {\n    // Get all order IDs from your database\n    const orders = await Order.find({}, 'orderId');\n    const orderIds = orders.map(order => order.orderId);\n    \n    // Fetch from Cashfree\n    const transactions = await fetchAllTransactions(orderIds);\n    \n    // Print to console\n    printTransactions(transactions);\n    \n    res.json({ success: true, transactions });\n  } catch (error) {\n    res.status(500).json({ error: error.message });\n  }\n};\n```\n\n2. **Filter by Date Range**: Add date filtering to fetch recent transactions only:\n\n```javascript\n// Get transactions from last 30 days\nconst thirtyDaysAgo = new Date();\nthirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n\nconst recentOrders = await Order.find({\n  createdAt: { $gte: thirtyDaysAgo }\n}, 'orderId');\n```\n\n## 🛠️ Available Functions\n\n### Core Functions (from fetchTransactions.js)\n- `fetchOrderDetails(orderId)` - Get details for a single order\n- `fetchPaymentDetails(orderId)` - Get payment info for an order\n- `fetchAllTransactions(orderIds)` - Get multiple transaction details\n- `printTransactions(transactions)` - Pretty print transactions to console\n- `getTransactionSummary(transactions)` - Get summary statistics\n\n### Controller Functions (from cashfreeController.js)\n- `getAllTransactions(req, res)` - API endpoint for bulk transaction fetch\n- `getOrderDetails(req, res)` - API endpoint for single order details\n- `printAllTransactions(req, res)` - API endpoint that prints to console\n\n## 🔍 Error Handling\n\nThe system handles various error scenarios:\n- Invalid order IDs\n- Network connectivity issues\n- Cashfree API errors\n- Missing environment variables\n\nErrors are logged to console and returned in API responses.\n\n## 📝 Example Usage\n\n### Using cURL\n```bash\n# Fetch multiple transactions\ncurl -X POST http://localhost:3000/api/cashfree/transactions \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"orderIds\": [\"ORDER123\", \"ORDER456\"]}'\n\n# Get single order\ncurl http://localhost:3000/api/cashfree/order/ORDER123\n\n# Print transactions to server console\ncurl -X POST http://localhost:3000/api/cashfree/print-transactions \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"orderIds\": [\"ORDER123\"]}'\n```\n\n### Using Postman\n1. Create a POST request to `http://localhost:3000/api/cashfree/transactions`\n2. Set Content-Type to `application/json`\n3. Add request body:\n```json\n{\n  \"orderIds\": [\"ORDER123\", \"ORDER456\", \"ORDER789\"]\n}\n```\n4. Send the request and check both the API response and your server console\n\n### Using Frontend (JavaScript)\n```javascript\n// Fetch transactions from frontend\nconst fetchTransactions = async (orderIds) => {\n  try {\n    const response = await fetch('/api/cashfree/transactions', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({ orderIds })\n    });\n    \n    const data = await response.json();\n    console.log('Transactions:', data.transactions);\n    console.log('Summary:', data.summary);\n    \n    return data;\n  } catch (error) {\n    console.error('Error fetching transactions:', error);\n  }\n};\n\n// Usage\nfetchTransactions(['ORDER123', 'ORDER456']);\n```\n\n## 📋 Testing Checklist\n\n### Before Running\n- [ ] Cashfree credentials are set in `.env` file\n- [ ] Server is running on correct port\n- [ ] You have valid order IDs to test with\n- [ ] Network connection is stable\n\n### Test Steps\n1. **Test Environment Setup**:\n   ```bash\n   npm run test-transactions\n   ```\n\n2. **Test with Real Order IDs**:\n   ```bash\n   npm run fetch-transactions YOUR_ORDER_ID_1 YOUR_ORDER_ID_2\n   ```\n\n3. **Test API Endpoints**:\n   - Use Postman or cURL to test the API endpoints\n   - Check server console for detailed transaction logs\n\n4. **Verify Output**:\n   - Check console output for formatted transaction details\n   - Verify API responses contain correct data structure\n   - Confirm transaction summaries are accurate\n\n## 🚨 Important Notes\n\n### Security\n- Never expose your Cashfree secret key in client-side code\n- Always use HTTPS in production\n- Consider implementing rate limiting for API endpoints\n\n### Cashfree API Limitations\n- The API requires specific order IDs to fetch transaction details\n- There's no direct \"get all transactions\" endpoint\n- Rate limits may apply (check Cashfree documentation)\n\n### Production Considerations\n- Change the base URL from `sandbox.cashfree.com` to `api.cashfree.com` for production\n- Implement proper error logging\n- Consider caching transaction data to reduce API calls\n- Add database storage for transaction history\n\n## 🔧 Customization\n\n### Adding More Payment Details\nYou can extend the `fetchTransactions.js` file to include additional payment information:\n\n```javascript\n// Add settlement details\nexport const fetchSettlementDetails = async (orderId) => {\n  try {\n    const url = `https://sandbox.cashfree.com/pg/orders/${orderId}/settlements`;\n    const response = await axios.get(url, {\n      headers: {\n        'x-api-version': '2022-09-01',\n        'x-client-id': process.env.CASHFREE_APP_ID,\n        'x-client-secret': process.env.CASHFREE_SECRET_KEY\n      }\n    });\n    return response.data;\n  } catch (error) {\n    console.error('Error fetching settlement details:', error.message);\n    return null;\n  }\n};\n```\n\n### Custom Filtering\nAdd filters for transaction types, date ranges, or amounts:\n\n```javascript\nexport const filterTransactions = (transactions, filters = {}) => {\n  return transactions.filter(transaction => {\n    // Filter by status\n    if (filters.status && transaction.orderStatus !== filters.status) {\n      return false;\n    }\n    \n    // Filter by amount range\n    if (filters.minAmount && parseFloat(transaction.orderAmount) < filters.minAmount) {\n      return false;\n    }\n    \n    if (filters.maxAmount && parseFloat(transaction.orderAmount) > filters.maxAmount) {\n      return false;\n    }\n    \n    // Filter by date range\n    if (filters.startDate && new Date(transaction.createdAt) < new Date(filters.startDate)) {\n      return false;\n    }\n    \n    if (filters.endDate && new Date(transaction.createdAt) > new Date(filters.endDate)) {\n      return false;\n    }\n    \n    return true;\n  });\n};\n```\n\n## 📞 Support\n\nIf you encounter issues:\n1. Check the console logs for detailed error messages\n2. Verify your Cashfree credentials\n3. Ensure order IDs exist in Cashfree system\n4. Check network connectivity\n5. Review Cashfree API documentation for any changes\n\n## 🔄 Next Steps\n\n1. **Database Integration**: Store fetched transactions in your MongoDB for faster access\n2. **Scheduled Fetching**: Set up cron jobs to automatically fetch new transactions\n3. **Dashboard Integration**: Create a frontend dashboard to display transaction analytics\n4. **Webhook Integration**: Implement Cashfree webhooks for real-time transaction updates\n5. **Reconciliation**: Build tools to match transactions with your internal records\n\nThis system provides a solid foundation for managing Cashfree transactions in your gym management system!